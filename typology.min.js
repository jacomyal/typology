/**
 * typology - A data validation library for Node.js and the browser.
 * @version v0.3.1
 * @link https://github.com/jacomyal/typology
 * @license MIT
 */
!function(e){"use strict";function t(e){function t(e,a){var p,d,u,f,c,l,s,h,y,g,v=!1,b=!1,x=null===a||void 0===a?String(a):r[Object.prototype.toString.call(a)]||"object",w=null===e||void 0===e?String(e):r[Object.prototype.toString.call(e)]||"object";if("string"===w){for(p=e.replace(/^[\?\!]/,"").split(/\|/),u=p.length,d=0;u>d;d++)if(!n[p[d]]&&"undefined"==typeof i[p[d]])throw new Error("Invalid type.");for("?"===e.charAt(0)?v=!0:"!"===e.charAt(0)&&(b=!0),u=p.length,d=0;u>d;d++)if("undefined"!=typeof i[p[d]]&&("function"==typeof i[p[d]].type?i[p[d]].type.call(o,a)===!0:!t(i[p[d]].type,a).error))return b?{error:'Expected a "'+e+'" but found a "'+p[d]+'".',expected:e,type:p[d],value:a}:{expected:e,type:p[d],value:a};return null===a||void 0===a?b||v?{nully:!0,expected:e,type:x,value:a}:{error:'Expected a "'+e+'" but found a "'+x+'".',expected:e,type:x,value:a}:(y=~p.indexOf("*"),g=~p.indexOf(x),b&&(y||g)?{error:'Expected a "'+e+'" but found a "'+(g?x:"*")+'".',expected:e,type:g?x:"*",value:a}:b||y||g?{expected:e,type:x,value:a}:{error:'Expected a "'+e+'" but found a "'+x+'".',expected:e,type:x,value:a})}if("object"===w){if("object"!==x)return{error:'Expected an object but found a "'+x+'".',expected:e,type:x,value:a};for(h=Object.keys(e),u=h.length,l=0,f=0;u>f;f++){if(c=t(e[h[f]],a[h[f]]),c.error)return c.path=c.path?[h[f]].concat(c.path):[h[f]],c;c.nully&&l++}if(s=Object.keys(a),s.length>u-l)for(u=s.length,f=0;u>f;f++)if("undefined"==typeof e[s[f]])return{error:'Unexpected key "'+s[f]+'".',expected:e,type:x,value:a};return{expected:e,type:x,value:a}}if("array"===w){if(1!==e.length)throw new Error("Invalid type.");if("array"!==x)return{error:'Expected an array but found a "'+x+'".',expected:e,type:x,value:a};for(u=a.length,d=0;u>d;d++)if(c=t(e[0],a[d]),c.error)return c.path=c.path?[d].concat(c.path):[d],c;return{expected:e,type:x,value:a}}throw new Error("Invalid type.")}var o=this,i={};if(this.add=function(e,t){var r,o,a,p,d,u;if(1===arguments.length){if("object"!==this.get(e))throw new Error("If types.add is called with one argument, this one has to be an object.");r=e,p=r.id,u=r.type}else{if(2!==arguments.length)throw new Error("types.add has to be called with one or two arguments.");if("string"!=typeof e||!e)throw new Error("If types.add is called with more than one argument, the first one must be the string id.");p=e,u=t}if("string"!==this.get(p)||0===p.length)throw new Error("A type requires an string id.");if(void 0!==i[p]&&"proto"!==i[p])throw new Error('The type "'+p+'" already exists.');if(n[p])throw new Error('"'+p+'" is a reserved type name.');i[p]=1,a=(r||{}).proto||[],a=Array.isArray(a)?a:[a],d={};for(o in a)void 0===i[a[o]]&&(i[a[o]]=1,d[a[o]]=1);if("function"!==this.get(u)&&!this.isValid(u))throw new Error("A type requires a valid definition. This one can be a preexistant type or else a function testing given objects.");if(i[p]=void 0===r?{id:p,type:u}:{},void 0!==r)for(o in r)i[p][o]=r[o];for(o in d)o!==p&&delete i[o];return this},this.has=function(e){return!!i[e]},this.get=function(e){return null===e||void 0===e?String(e):r[Object.prototype.toString.call(e)]||"object"},this.check=function(e,r,n){var o=t(e,r);if(n&&o.error){var i=new Error;throw i.message=o.error,i.expected=o.expected,i.type=o.type,i.value=o.value,i.path=o.path,i}return!o.error},this.isValid=function(e){var t,o,a,p,d,u,f=null===e||void 0===e?String(e):r[Object.prototype.toString.call(e)]||"object";if("string"===f){for(t=e.replace(/^[\?\!]/,"").split(/\|/),d=Object.keys(t),p=d.length,a=0;p>a;a++)if(!n[t[d[a]]]&&"undefined"==typeof i[t[d[a]]])return!1;return!0}if("object"===f){for(u=Object.keys(e),p=u.length,o=0;p>o;o++)if(!this.isValid(e[u[o]]))return!1;return!0}return"array"===f&&1===e.length?this.isValid(e[0]):!1},this.add("type",function(e){return this.isValid(e)}.bind(this)),this.add("primitive",function(e){return!e||!(e instanceof Object||"object"==typeof e)}),e=e||{},"object"!==this.get(e))throw Error("Invalid argument.");for(var a in e)this.add(a,e[a])}var r={},n={"*":!0};!function(){var e,t,o=["Boolean","Number","String","Object","Array","Function","Arguments","RegExp","Date"];for(e in o)t=o[e],n[t.toLowerCase()]=!0,r["[object "+t+"]"]=t.toLowerCase()}();var o=t;t.call(o),Object.defineProperty(o,"version",{value:"0.3.1"}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=o),exports.types=o):"function"==typeof define&&define.amd?define("typology",[],function(){return o}):e.types=o}(this);