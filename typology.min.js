/**
 * typology - A data validation library for Node.js and the browser.
 * @version v0.2.1
 * @link https://github.com/jacomyal/typology
 * @license MIT
 */
!function(){"use strict";function e(e){function t(e,i){var a,s,f,l,h,d,u,p,c=!1,y=!1,g=r.get(e);if("string"===r.get(i)){for(a=i.replace(/^[\?\!]/,"").split(/\|/),f=a.length,s=0;f>s;s++)if(o.indexOf(a[s])<0&&!(a[s]in n))throw new Error("Invalid type.");if(i.match(/^\?/)&&(c=!0),i.replace(/^\?/,"").match(/^\!/)&&(y=!0),y&&c)throw new Error("Invalid type.");for(s in a)if(n[a[s]]&&("function"==typeof n[a[s]].type?n[a[s]].type.call(r,e)===!0:!t(e,n[a[s]].type)))return y?(h=new Error,h.message='The type "'+a[s]+'" is not allowed',h.matched=a[s],h.type=i,h.value=e,h):null;return null===e||void 0===e?y||c?null:(h=new Error,h.message='The type "'+e+'" is not allowed.',h.type=i,h.value=e,h):(u=~a.indexOf("*"),p=~a.indexOf(g),y&&(u||p)?(h=new Error,h.message='The type "'+(p?g:"*")+'" is not allowed.',h.matched=p?g:"*",h.type=i,h.value=e,h):y||u||p?null:(h=new Error,h.message='The type "'+g+'" is not allowed.',h.type=i,h.value=e,h))}if("object"===r.get(i)){if("object"!==g)return h=new Error,h.message="An object is expected.",h.type=i,h.value=e,h;for(l in i)if(d=t(e[l],i[l]))return h=d,h.path=h.path?[s].concat(h.path):[s],h;for(l in e)if(void 0===i[l])return h=new Error,h.message='The key "'+l+'" is not expected.',h.type=i,h.value=e,h;return null}if("array"===r.get(i)){if(1!==i.length)throw new Error("Invalid type.");if("array"!==g)return h=new Error,h.message="An array is expected.",h.type=i,h.value=e,h;for(f=e.length,s=0;f>s;s++)if(d=t(e[s],i[0]))return h=d,h.path=h.path?[s].concat(h.path):[s],h;return null}throw new Error("Invalid type.")}var r=this,n={};if(this.add=function(e,t){var r,i,a,s,f,l;if(1===arguments.length){if("object"!==this.get(e))throw new Error("If types.add is called with one argument, this one has to be an object.");r=e,s=r.id,l=r.type}else{if(2!==arguments.length)throw new Error("types.add has to be called with one or two arguments.");if("string"!=typeof e||!e)throw new Error("If types.add is called with more than one argument, the first one must be the string id.");s=e,l=t}if("string"!==this.get(s)||0===s.length)throw new Error("A type requires an string id.");if(void 0!==n[s]&&"proto"!==n[s])throw new Error('The type "'+s+'" already exists.');if(~o.indexOf(s))throw new Error('"'+s+'" is a reserved type name.');n[s]=1,a=(r||{}).proto||[],a=Array.isArray(a)?a:[a],f={};for(i in a)void 0===n[a[i]]&&(n[a[i]]=1,f[a[i]]=1);if("function"!==this.get(l)&&!this.isValid(l))throw new Error("A type requires a valid definition. This one can be a preexistant type or else a function testing given objects.");if(n[s]=void 0===r?{id:s,type:l}:{},void 0!==r)for(i in r)n[s][i]=r[i];for(i in f)i!==s&&delete n[i];return this},this.has=function(e){return!!n[e]},this.get=function(e){return null===e||void 0===e?String(e):i[Object.prototype.toString.call(e)]||"object"},this.check=function(e,r){return!t(e,r)},this.isValid=function(e){var t,r,i;if("string"===this.get(e)){t=e.replace(/^[\?\!]/,"").split(/\|/);for(i in t)if(o.indexOf(t[i])<0&&!(t[i]in n))return!1;return!0}if("object"===this.get(e)){for(r in e)if(!this.isValid(e[r]))return!1;return!0}return"array"===this.get(e)&&1===e.length?this.isValid(e[0]):!1},this.add("type",function(e){return this.isValid(e)}.bind(this)),this.add("primitive",function(e){return!e||!(e instanceof Object||"object"==typeof e)}),e=e||{},"object"!==this.get(e))throw Error("Invalid argument.");for(var a in e)this.add(a,e[a])}var t,r,n=["Arguments","Boolean","Number","String","Function","Array","Date","RegExp","Object"],i={},o=["*"];for(t in n)r=n[t],o.push(r.toLowerCase()),i["[object "+r+"]"]=r.toLowerCase();var a=e;e.call(a),Object.defineProperty(a,"version",{value:"0.2.1"}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=a),exports.types=a):"function"==typeof define&&define.amd?define("typology",[],function(){return a}):this.types=a}(this);